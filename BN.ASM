.model small
.stack 100
.data

	displayBN db 13, 10, "___________________________"
    		  db 13, 10, "::Welcome to BONUS Module::"
    		  db 13, 10, "___________________________",13,10,"$"
    
    	exitBN db 13, 10, "__________________________"
    	       db 13, 10, "::Exit BONUS Module ::"
    	       db 13, 10, "__________________________$"


  	;gross pay
	BONUS_GET DB 10,13,"Bonus ? (YES=y/NO=n) :$"
	PROMPTBONUSRATE DB 10,13,"Enter Bonus Rate (00-20)%:$" 
   	BONUSRATES DB 2 DUP(0)
	BONUS_RATE DB ?
	SUCCESS DB 10,13,"Success key-in !$"
	WRBONUSRATE DB 10,13,"Wrong Rate!!! Please key in rate in (00-20)% only!$"
	nline DB 10,13,"$" 
	CONFIRM_BNRATE DB 10,13,"Confirm BONUS Rate(y/n):$"
	ERRYESNO DB 10,13,"Please enter y or n only !!!$"
	DISBN DB 10,13,"BONUS  : RM$"
	DECIMAL DB ".000$"
	

	;BONUS
	TOTALGP DW ? 		;TEMP TOTAL GROSS P
	;TOTALBONUS DB ?
	TOTALBN DW ?
	TOTALBNDIS DB 4 DUP(0)
	; Constants
    	YES equ 'y'
    	NO equ 'n'
.code
main proc
	mov ax,@data
	mov ds,ax
	
	MOV AH,09H
	LEA DX,displayBN
	INT 21H

BNCONFIRM:
	;DISPLAY GROSS PAY CONFIRM 
	MOV AH,09H
	LEA DX,BONUS_GET
	INT 21H
	
	MOV AH,01H
	INT 21H
	CMP AL,YES
	JE  GETBONUS
	CMP AL,NO
	JE  EXIT
	JMP ERRBN
	
GETBONUS:	
	;clear screen
		
	;GET BONUS RATE
	MOV AH,09H
	LEA DX,PROMPTBONUSRATE
	INT 21H

	MOV CX,2
	MOV SI,0
	CALL BONUSL

	;CHECK BONUS RATE
	CMP BONUS_RATE,0
	JL  XBNRANGE
	CMP BONUS_RATE,20
	JG  XBNRANGE
	JMP CORRECT
	
XBNRANGE:
	;DISPALY ERROR MESSAGES (BONUS)
	MOV AH,09H
	LEA DX,WRBONUSRATE
	INT 21H
	JMP GETBONUS

;*
EXIT:
	MOV AH,09H
	LEA DX,EXITBN
	INT 21H
	MOV AH,4CH
	INT 21H
;*

ERRBN:
	MOV AH,09H
	LEA DX,ERRYESNO
	INT 21H
	JMP BNCONFIRM

CORRECT:
	;DISPLAY CORRECT
	MOV AH,09H
	LEA DX,SUCCESS
	INT 21H

CONFIRMRATE:
	;CONFIRMATION
    	MOV AH,09H
    	LEA DX,CONFIRM_BNRATE 
    	INT 21H

   	MOV AH,01H
    	INT 21H
    	CMP AL,YES
   	JE  BONUSCAL	 	;YES - CAL BONUS
    	CMP AL,NO
   	JE  BNCONFIRM 		;IF NO - BACK START OF BONUS MODULE
   	JMP ERRCONFIRMRATE

ERRCONFIRMRATE:
	MOV AH,09H
	LEA DX,ERRYESNO		
	INT 21H
	JMP CONFIRMRATE

BONUSCAL:
	MOV AX,0
	MOV DX,0
	;TOTAL GROSS PAY
	MOV TOTALGP,3800  	;3800 = 0ED8 H
	
	;GET BONUS BY MUL BONUS RATE
    	MOV AX,TOTALGP		;AL = 0ED8 H(TOTAL GP)
	MOV BX,100
	DIV BX       		;AL = 3800 (0ED8 H) / 100 = 38 (26 H)
	MUL BONUS_RATE		;RM38 X 20 = RM 760 (02F8 H)
	;TO STORE THE TOTAL BONUS PAY
	MOV TOTALBN,AX 		;TOTAL BONUS PAY = 760
	
     	;DISPLAY BONUS PAY
	MOV AH,09H
	LEA DX,DISBN
	INT 21H
	
	;*IF BONUS PAY LARGE THAN 1000 (CHANGE!!!)*
	MOV AX,0
	MOV DX,0
	MOV AX,TOTALBN		;TOTAL BONUS PAY = 760 (02F8 H)
	MOV BX,100		;760/100 = 7.6(AH = 00 AL = 07 DL= 06 H)
	DIV BX
	MOV BL,10
	DIV BL			;AL = 00 H AH=07 H DL=60 H DH=00 H
	MOV TOTALBNDIS[0],AL	
	MOV TOTALBNDIS[1],AH	
	MOV TOTALBNDIS[2],DL
	MOV TOTALBNDIS[3],DH
	
	;DISPLAY NUMBER 1 DIGIT
	MOV AH,02H
	MOV DL,TOTALBNDIS[0]
	ADD DL,30H
	INT 21H

	;DISPLAY NUMBER 2 DIGIT
	MOV AH,02H
	MOV DL,TOTALBNDIS[1]
	ADD DL,30H
	INT 21H
	
	MOV AX,0
	MOV AL,TOTALBNDIS[2] 	;AX = 0006
	DIV BL    		;AL=06 AH=00
	MOV TOTALBNDIS[2],AL	;AL=00
	MOV TOTALBNDIS[3],AH	;AH=00
	

	;DISPLAY NUMBER 3 DIGIT
	MOV AH,02H
	MOV DL,TOTALBNDIS[2]
	ADD DL,30H
	INT 21H

	;DISPLAY NUMBER 4 DIGIT
	MOV AH,02H
	MOV DL,TOTALBNDIS[3]
	ADD DL,30H
	INT 21H

	MOV AH,09H
	LEA DX,DECIMAL
	INT 21H
	
	JMP EXIT
main endp
BONUSL:
	MOV AH,01H
	INT 21H
	SUB AL,30H
	MOV BONUSRATES[SI],AL
	INC SI
      LOOP BONUSL

	 ; Validate input
    	MOV AL, BONUSRATES[0]
    	MOV DL, 10
    	MUL DL
    	ADD AL, BONUSRATES[1]
    	MOV BONUS_RATE, AL

	RET

	end main
	